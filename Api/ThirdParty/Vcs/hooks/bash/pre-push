#!/bin/bash
# === pre-push hook (Bash version) ===

# Exit on any error
set -e

# First two arguments are: remote name and remote URL
REMOTE_NAME="$1"
REMOTE_URL="$2"

# Navigate to the project root from .git/hooks
cd "$(dirname "$0")/../.."

# Path to the pre-push hook scripts
HOOK_DIR="scripts/pre-push"

# Check if the directory exists
if [ -d "$HOOK_DIR" ]; then
  cd "$HOOK_DIR"

  # Loop over all .js files and run them with remote info
  for file in *.js; do
    # Ensure the file exists and is a regular file
    if [ -f "$file" ]; then
      echo "Running Node script: $file with remote: $REMOTE_NAME, URL: $REMOTE_URL"
      node "$file" "$REMOTE_NAME" "$REMOTE_URL" || {
        echo "Script $file failed. Aborting push."
        exit 1
      }
    fi
  done
else
  echo "No pre-push scripts found in $HOOK_DIR."
fi

cd ../../

dotnet run git pre-push "$COMMIT_MSG_FILE" || {
  echo "Dotnet script failed. Aborting commit."
  exit 1
}

exit 0
