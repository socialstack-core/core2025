#!/bin/bash
# === commit-msg hook (Bash version) ===

# Exit on any error
set -e

# First argument is the path to the commit message file
COMMIT_MSG_FILE="$1"

# Navigate to the project root from .git/hooks
cd "$(dirname "$0")/../.."

# Path to the commit-msg hook scripts
HOOK_DIR="scripts/commit-msg"

# Check if the directory exists
if [ -d "$HOOK_DIR" ]; then
  cd "$HOOK_DIR"

  # Loop over .js files and run them with the commit message file as argument
  for file in *.js; do
    # Ensure file exists before running
    if [ -f "$file" ]; then
      echo "Running Node script: $file with commit message file: $COMMIT_MSG_FILE"
      node "$file" "$COMMIT_MSG_FILE" || {
        echo "Script $file failed. Aborting commit."
        exit 1
      }
    fi
  done
else
  echo "No commit-msg scripts found in $HOOK_DIR."
fi

exit 0
