$signpost-padding: px_to_rem(8);
$signpost-border-radius: px_to_rem(8);

// default to wide layout
// (e.g. list view / shopping cart)
.ui-product-signpost {
	$ui-product-signpost: &;
	container-name: product-signpost;
	container-type: inline-size;
	border: 1px solid #ddd;
	border-radius: $signpost-border-radius;

	&__outer {
		display: flex;
		gap: px_to_rem(24);
		align-items: center;
		transition: box-shadow .3s ease-in-out;
		border-radius: $signpost-border-radius;
		padding: $signpost-padding;
	}

	&__inner {
		width: 100%;
	}

	&__inner,
	&__inner.ui-link {
		flex-grow: 1;
		display: grid;
		gap: px_to_rem(12) px_to_rem(24);
		grid-template-columns: px_to_rem(150) 1fr;
		grid-template-rows: 1fr auto 1fr;
		grid-template-areas:
			"image category price"
			"image name price"
			"image stock price";
		outline: 0 !important;
		border-radius: $signpost-border-radius;
	}

	.ui-product-qty {
		flex-shrink: 0;
	}

	&:not(#{$ui-product-signpost}--disabled):hover {
		box-shadow: 0 0 px_to_rem(16) 0 rgba(#210818, 25%);

		.ui-image__wrapper .ui-image {
			transform: none;
		}

	}

	&:has(#{$ui-product-signpost}__inner:focus-within) {
		box-shadow: 
			0 0 0 0.25rem var(--primary-shadow), 
			0 0 1rem 0 rgba(33, 8, 24, .25);
	}

	&__image {
		grid-area: image;
		position: relative;
		width: 100%;
		//width: calc(100% + (2 * #{$signpost-padding}));
		//margin-top: -$signpost-padding;
		height: calc(100% + (2 * #{$signpost-padding}));
		margin-left: -$signpost-padding;
		aspect-ratio: 1;
		//border-radius: $signpost-border-radius $signpost-border-radius 0 0;
		border-radius: $signpost-border-radius 0 0 $signpost-border-radius;
	}

	&__featured {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		//border-radius: $signpost-border-radius $signpost-border-radius  0 0;
		border-radius: $signpost-border-radius 0 0 0;
		background: var(--featured-bg, var(--info));
		font-size: px_to_rem(10);
		font-weight: var(--featured-font-weight, 700);
		text-transform: var(--featured-text-transform, none);
		color: var(--featured-fg, var(--info-fg));
		display: flex;
		align-items: center;
		justify-content: center;
		padding: px_to_rem(4) px_to_rem(8);
		gap: px_to_rem(8);
		z-index: 1;

		> i {
			font-size: px_to_rem(13);
		}

	}

	.ui-image__wrapper {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 100%;
		height: 100%;
		//border-radius: $signpost-border-radius $signpost-border-radius 0 0;
		border-radius: $signpost-border-radius 0 0 $signpost-border-radius;

		&::after {
			content: "";
			background: linear-gradient(225deg, rgba(255, 255, 255, 0) 0%, rgba(74, 74, 73, 0.1) 100%);
			position: absolute;
			inset: 0;
			//border-radius: $signpost-border-radius $signpost-border-radius 0 0;
			border-radius: $signpost-border-radius 0 0 $signpost-border-radius;
		}

		.ui-image {
			max-width: 100%;
			//height: auto;
			width: 100%;
			height: 100%;
			//object-fit: cover;
			object-fit: contain;
			//aspect-ratio: 149 / 140;
			transform: scale(.95);
			transition: transform .2s ease;
			//border-radius: $signpost-border-radius $signpost-border-radius 0 0;
			border-radius: $signpost-border-radius 0 0 $signpost-border-radius;

			// disable hover effect for broken images
			&[src$="no-image"] {
				transform: none;
			}
		}

	}

	&__approved {
		position: absolute;
		left: px_to_rem(4);
		bottom: px_to_rem(4);
		border-radius: px_to_rem(4);
		width: px_to_rem(28);
		height: px_to_rem(28);
		display: flex;
		align-items: center;
		justify-content: center;
		background: var(--approved-bg, var(--success));
		padding: 0 !important;

		> i {
			color: var(--approved-fg, var(--success-fg));
			font-size: px_to_rem(13);
		}

	}

	&__category {
		grid-area: category;
		align-self: end;
		display: flex;
		align-items: center;
		gap: px_to_rem(8);
		font-size: px_to_rem(10);
		color: var(--site-fg, #000);
		text-decoration: none !important;
		white-space: nowrap;
		max-width: 100%;

		> i {
			font-size: px_to_rem(12);
			flex-shrink: 0;
		}

		span {
			flex: 1;
			overflow: hidden;
			text-overflow: ellipsis;
		}
	}

	&__name {
		grid-area: name;
		font-size: px_to_rem(15);
		color: var(--site-fg, #000);
		display: -webkit-box;
		-webkit-box-orient: vertical;
		-webkit-line-clamp: 2;
		line-clamp: 2;
		overflow: hidden;
		text-decoration: none !important;
	}

	&--disabled {

		#{$ui-product-signpost}__outer {
			//padding: 0;
		}

		#{$ui-product-signpost}__name {
			min-height: 0;
		}

		&:hover {
			box-shadow: none;
		}
	}

	.ui-product-price {
		text-decoration: none !important;
	}

	.ui-product-stock {
		grid-area: stock;
		align-self: start;
	}

	.ui-product-qty {
		//width: px_to_rem(196);
		min-width: px_to_rem(196);
	}

	.ui-product-price {
		grid-area: price;
	}
}

// TODO: find a better way of handling this
// for some reason, the increase to width which appears centred elsewhere (e.g. product category view)
// fails in the context of the basket popover window (offset to the right)
.site-nav__basket-wrapper {

	.ui-product-signpost {

		&__image {
			margin-left: -$signpost-padding;
		}

	}
}

// similar thing happens with basket view
.shopping-cart__table {

	.ui-product-signpost {

		&__image {
			margin-top: -$signpost-padding;
		}

		&__outer {
			padding-right: px_to_rem(20);
		}

	}
}

@container product-signpost (width < #{px_to_rem(350)}) {

	.ui-product-signpost {

		&__outer {
			flex-direction: column;
			gap: px_to_rem(12);
			align-items: flex-start;
		}

		&__inner,
		&__inner.ui-link {
			display: flex;
			flex-direction: column;
			gap: px_to_rem(12);
		}

		&__approved {
			width: px_to_rem(40);
			height: px_to_rem(40);

			> i {
				font-size: px_to_rem(24);
			}

		}

		&__name {
			align-self: flex-start;
			min-height: px_to_rem(45);
		}

		&__image {
			width: calc(100% + (2 * #{$signpost-padding}));
			margin-top: -$signpost-padding;
			height: 100%;
			margin-left: 0;
		}

		&__image,
		&__featured,
		.ui-image__wrapper, 
		.ui-image__wrapper::after,
		.ui-image__wrapper .ui-image {
			border-radius: $signpost-border-radius $signpost-border-radius 0 0;
		}

		&__category {
			align-self: flex-start;
		}

		.ui-product-price {
			align-self: flex-start;
		}

		.ui-product-qty {
			width: 100%;
			min-width: 0;
		}

	}
}

@container product-signpost (width < #{px_to_rem(200)}) {

	.ui-product-signpost {

		&__approved {
			width: px_to_rem(28);
			height: px_to_rem(28);

			> i {
				font-size: px_to_rem(13);
			}

		}

		&__name {
			align-self: flex-start;
			-webkit-line-clamp: 3;
			line-clamp: 3;
			min-height: px_to_rem(67.5);
		}
	}
}
